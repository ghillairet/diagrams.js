<!DOCTYPE html>  <html> <head>   <title>shape.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="arrows.html">                 arrows.js               </a>                                           <a class="source" href="anchor.html">                 anchor.js               </a>                                           <a class="source" href="connection.html">                 connection.js               </a>                                           <a class="source" href="end.html">                 end.js               </a>                                           <a class="source" href="label.html">                 label.js               </a>                                           <a class="source" href="diagram.html">                 diagram.js               </a>                                           <a class="source" href="element.html">                 element.js               </a>                                           <a class="source" href="extensions.html">                 extensions.js               </a>                                           <a class="source" href="palette.html">                 palette.js               </a>                                           <a class="source" href="anchor.html">                 anchor.js               </a>                                           <a class="source" href="compartment.html">                 compartment.js               </a>                                           <a class="source" href="dragger.html">                 dragger.js               </a>                                           <a class="source" href="image.html">                 image.js               </a>                                           <a class="source" href="label.html">                 label.js               </a>                                           <a class="source" href="selector.html">                 selector.js               </a>                                           <a class="source" href="shape.html">                 shape.js               </a>                                           <a class="source" href="svgelement.html">                 svgelement.js               </a>                                           <a class="source" href="line.html">                 line.js               </a>                                           <a class="source" href="point.html">                 point.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               shape.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Shape</p>

<pre><code> showcase.Circle = Diagram.Shape.extend({
      type: 'showcase.Circle',
      figure: {
          type: 'circle',
          r: 30,
          fill: 'red',
          stroke: 'rgb(120, 120, 200)',
          'stroke-width': 2
      }
  });
</code></pre>

<p>new CircleNode( { id: 0, x: 10, y: 10, fill: 'red' } )
new CircleNode( { id: 1, x: 10, y: 10, radius: 23 } )</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Shape</span> <span class="o">=</span> <span class="nx">Diagram</span><span class="p">.</span><span class="nx">Shape</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">attributes</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">figure</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Figure is not specified.&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">attributes</span> <span class="o">||</span> <span class="p">(</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{});</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Initialize attributes object that stores object values</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">parent</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">diagram</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">diagram</span> <span class="o">:</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">diagram</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">isConnectable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">shadow</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">resizable</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resizable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">draggable</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">draggable</span> <span class="o">=</span> <span class="kc">true</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">inEdges</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">outEdges</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">());</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Must be clone</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">figure</span><span class="p">));</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;attr&#39;</span><span class="p">),</span> <span class="k">this</span><span class="p">.</span><span class="nx">_attr</span><span class="p">(</span><span class="nx">attributes</span><span class="p">));</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">initChildren</span><span class="p">(</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">children</span> <span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">initialize</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">extend</span> <span class="o">=</span> <span class="nx">extend</span><span class="p">;</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Diagram</span><span class="p">.</span><span class="nx">SVGElement</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Diagram</span><span class="p">.</span><span class="nx">Draggable</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Diagram</span><span class="p">.</span><span class="nx">Selectable</span><span class="p">);</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">clone</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">clone</span><span class="p">.</span><span class="nx">attr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">attr</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">clone</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">disconnect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">edge</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">inEdges</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">inEdges</span><span class="p">,</span> <span class="nx">edge</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">outEdges</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">outEdges</span><span class="p">,</span> <span class="nx">edge</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initialize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">properties</span> <span class="p">)</span> <span class="p">{};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initChildren</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">children</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">children</span> <span class="o">&amp;&amp;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>This is a load situation</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">children</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">child</span> <span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">shape</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>if child already initialized, recreate it from its attributes.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">attributes</span> <span class="o">?</span> <span class="nx">child</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="o">:</span> <span class="nx">child</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;Diagram.Label&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">shape</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createLabel</span><span class="p">(</span> <span class="nx">data</span> <span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;Diagram.Compartment&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">shape</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createCompartment</span><span class="p">(</span> <span class="nx">data</span> <span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">shape</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span> <span class="nx">shape</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This is a new shape situation.
Creates Label if text element is present.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">shape</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createLabel</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">label</span> <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span> <span class="nx">shape</span> <span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Initializes compartments.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compartments</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">compartments</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">cpt</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">shape</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createCompartment</span><span class="p">(</span> <span class="nx">cpt</span> <span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span> <span class="nx">shape</span> <span class="p">);</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createLabel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">label</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">label</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Label</span><span class="p">(</span> <span class="nx">label</span> <span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>JSON
{
 "type": "diagram.Compartment",
 "children": [],
 attr: {}
}
Def
{
 layout: 'stack',
 figure: {
 top: 30,
 height: 20
}</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createCompartment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">compartment</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">compartment</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Compartment</span><span class="p">(</span> <span class="nx">compartment</span> <span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The render() function will create the Raphael element, initialize the inner
elements and call their render() method. This function also make the Raphael element
draggable if option set to true and handle click event on the element.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Render function.</span>
<span class="cm"> * @public</span>
<span class="cm"> * @returns {FigureShape}</span>
<span class="cm"> */</span>
<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">diagram</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Shape does not belong to a diagram&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">paper</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paper</span><span class="p">();</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_createFigure</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>FigureShape is accessible from the wrapper via the property controller.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">controller</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Creates shadow if shadow element is set to true.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shadow</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">createShadow</span><span class="p">();</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Make the element draggable if draggable is set to true.
Figure is draggable by default.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">draggable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">asDraggable</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">child</span><span class="p">)</span> <span class="p">{</span> <span class="nx">child</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Handle click event.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handleClickEvent</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createShadow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">box</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">getABox</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">paper</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">paper</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shadowWrapper</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">rect</span><span class="p">(</span><span class="nx">box</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="nx">fill</span><span class="o">:</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="nx">opacity</span><span class="o">:</span> <span class="mf">0.2</span><span class="p">}).</span><span class="nx">translate</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">shadowWrapper</span><span class="p">.</span><span class="nx">toBack</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">handleClickEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">evt</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">diagram</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">controller</span><span class="p">.</span><span class="nx">diagram</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">controller</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">controller</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Display selection box and resize anchors.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">controller</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Handle the connection to other nodes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">diagram</span><span class="p">.</span><span class="nx">canConnect</span><span class="p">(</span><span class="nx">controller</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">diagram</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">controller</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">direction</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="k">instanceof</span> <span class="nx">Diagram</span><span class="p">.</span><span class="nx">Compartment</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">layout</span> <span class="o">===</span> <span class="s1">&#39;stack&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">rdxy</span><span class="p">(</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">dy</span> <span class="o">:</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">direction</span> <span class="p">)</span> <span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>do nothing.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resizable</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">rdxy</span><span class="p">(</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">direction</span> <span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">children</span> <span class="o">&amp;&amp;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">child</span><span class="p">.</span><span class="nx">resize</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">child</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">direction</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCompartments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">child</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">child</span> <span class="k">instanceof</span> <span class="nx">Diagram</span><span class="p">.</span><span class="nx">Compartment</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Resize child compartments. This function is called when a new
element is added to a compartment via the function addInner().</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * @private</span>
<span class="cm"> */</span>
<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resizeCompartments</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">compartments</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCompartments</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Computes current height of compartments.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">compartments</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">memo</span><span class="p">,</span> <span class="nx">cpt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">memo</span> <span class="o">+</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>For each compartments, call resize(), and
computes the new y position of the next compartment.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">compartments</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">cpt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">cpt</span><span class="p">.</span><span class="nx">_resize</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">compartments</span><span class="p">,</span> <span class="nx">cpt</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Reposition next compartment</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">((</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">compartments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="nx">compartments</span><span class="p">[</span><span class="nx">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">nextY</span> <span class="o">=</span> <span class="nx">next</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">currentY</span> <span class="o">=</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span> <span class="c1">//attr(&#39;height&#39;);</span>
            <span class="kd">var</span> <span class="nx">diff</span> <span class="o">=</span> <span class="nx">currentY</span> <span class="o">-</span> <span class="nx">nextY</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">next</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">currentY</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Computes new height of compartments.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">newHeight</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">compartments</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">memo</span><span class="p">,</span> <span class="nx">cpt</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">memo</span> <span class="o">+</span> <span class="nx">cpt</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">);</span>
    <span class="p">},</span> <span class="mi">0</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If compartments height has increased, increase Shape height
accordingly.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">diff</span> <span class="o">=</span> <span class="nx">newHeight</span> <span class="o">-</span> <span class="nx">height</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">previousHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">previousHeight</span> <span class="o">+</span> <span class="nx">diff</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hidder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hidder</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resizer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">resizer</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">child</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">children</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hidder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hidder</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">child</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">child</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span> <span class="p">});</span>
<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">move</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">previousX</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">previousY</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span> <span class="nx">x</span><span class="p">});</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">y</span><span class="o">:</span> <span class="nx">y</span><span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">child</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>computes the new child positions
according to previous parent positions.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">ix</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">iy</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">ix</span> <span class="o">-</span> <span class="nx">previousX</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">iy</span> <span class="o">-</span> <span class="nx">previousY</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">child</span><span class="p">.</span><span class="nx">move</span><span class="p">(</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">,</span> <span class="nx">y</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">);</span>
    <span class="p">});</span>

<span class="p">};</span>

<span class="nx">Shape</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;children&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">child</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">child</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span> <span class="p">});</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">selectionAnchors</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">anchor</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">anchor</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span> <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">diagram</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 